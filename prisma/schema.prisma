// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

enum VaiTro {
  QUANTRIVIEN
  THANHTRA
  QUANLY
  NHANVIEN
}

enum PhamVi {
  CONGKHAI
  NOIBO
}

model NguoiDung {
  ma          Int      @id @default(autoincrement())
  maDonVi     Int?
  vaiTro      VaiTro   @default(NHANVIEN)
  hoTen       String
  email       String   @unique
  matKhau     String
  trangThai   Boolean  @default(true)
  anhDaiDien  String?
  ngayTao     DateTime @default(now())
  ngayCapNhat DateTime @updatedAt

  donVi DonVi? @relation(fields: [maDonVi], references: [ma])

  @@index([email]) // Thêm chỉ mục cho trường email
  @@index([maDonVi]) // Thêm chỉ mục cho trường maDonVi
}

model DonVi {
  ma        Int         @id @default(autoincrement())
  tenDonVi  String
  moTa      String?
  nguoiDung NguoiDung[]
  taiLieu   TaiLieu[]

  @@index([ma])
  @@index([tenDonVi]) // Thêm chỉ mục cho trường tenDonVi
}

model CapBanHanh {
  ma      Int       @id @default(autoincrement())
  tenCap  String
  moTa    String?
  taiLieu TaiLieu[]

  @@index([tenCap]) // Thêm chỉ mục cho trường tenCap
}

model LinhVuc {
  ma         Int         @id @default(autoincrement())
  maLinhVuc  String      @unique
  tenLinhVuc String
  moTa       String?
  tieuChuan  TieuChuan[]
  taiLieu    TaiLieu[]

  @@index([maLinhVuc]) // Thêm chỉ mục cho trường maLinhVuc
}

model ChuongTrinhDaoTao {
  ma         Int         @id @default(autoincrement())
  maCTDT     String      @unique
  tenCTDT    String
  moTa       String?
  namDanhGia Int
  ngayTao    DateTime    @default(now())
  tieuChuan  TieuChuan[]

  @@index([maCTDT]) // Thêm chỉ mục cho trường maCTDT
}

model TieuChuan {
  ma                Int                @id @default(autoincrement())
  maTieuChuan       String             @unique
  maLinhVuc         Int
  tenTieuChuan      String
  moTa              String?
  namDanhGia        Int
  ngayTao           DateTime           @default(now())
  linhVuc           LinhVuc            @relation(fields: [maLinhVuc], references: [ma])
  tieuChi           TieuChi[]
  ChuongTrinhDaoTao ChuongTrinhDaoTao? @relation(fields: [maCTDT], references: [ma])
  maCTDT            Int

  @@index([maCTDT]) // Thêm chỉ mục cho trường idCTDT
  @@index([maLinhVuc]) // Thêm chỉ mục cho trường maLinhVuc
}

model TieuChi {
  ma          Int         @id @default(autoincrement())
  maTieuChi   String      @unique
  maTieuChuan Int
  tenTieuChi  String
  moTa        String?
  namDanhGia  Int
  ngayTao     DateTime    @default(now())
  tieuChuan   TieuChuan   @relation(fields: [maTieuChuan], references: [ma])
  minhChung   MinhChung[]

  @@index([maTieuChuan]) // Thêm chỉ mục cho trường maTieuChuan
}

model MinhChung {
  ma           Int       @id @default(autoincrement())
  maMinhChung  String    @unique
  maTieuChi    Int
  tenMinhChung String
  moTa         String?
  ngayTao      DateTime  @default(now())
  taiLieu      TaiLieu[]
  tieuChi      TieuChi   @relation(fields: [maTieuChi], references: [ma])

  @@index([maTieuChi]) // Thêm chỉ mục cho trường maTieuChi
}

model LoaiVanBan {
  ma      Int       @id @default(autoincrement())
  moTa    String?
  taiLieu TaiLieu[]

  @@index([ma]) // Thêm chỉ mục cho trường maLoaiVanBan
}

model TaiLieu {
  ma           Int      @id @default(autoincrement())
  maDonVi      Int
  maLinhVuc    Int
  maCapBanHanh Int
  maLoaiVanBan Int
  maMinhChung  Int?
  tenTaiLieu   String
  trichYeu     String?
  moTa         String?
  phamVi       PhamVi
  ngayBanHanh  DateTime
  ngayTao      DateTime @default(now())
  ngayCapNhat  DateTime @updatedAt

  donVi      DonVi      @relation(fields: [maDonVi], references: [ma])
  linhVuc    LinhVuc    @relation(fields: [maLinhVuc], references: [ma])
  capBanHanh CapBanHanh @relation(fields: [maCapBanHanh], references: [ma])
  loaiVanBan LoaiVanBan @relation(fields: [maLoaiVanBan], references: [ma])
  file       File[]
  MinhChung  MinhChung? @relation(fields: [maMinhChung], references: [ma])

  @@index([ma]) // Thêm chỉ mục cho trường mâTàiLiệu
  @@index([maDonVi])
  @@index([maCapBanHanh])
  @@index([maLoaiVanBan])
  @@index([maLinhVuc])
  @@index([maMinhChung])
}

model File {
  ma          Int      @id @default(autoincrement())
  maTaiLieu   Int
  tenFile     String
  fileGoc     String
  ngayTao     DateTime @default(now())
  ngayTapNhat DateTime @updatedAt

  taiLieu TaiLieu @relation(fields: [maTaiLieu], references: [ma])

  @@index([maTaiLieu]) // Thêm chỉ mục cho trường maTaiLieu
}
